{% extends "layout.html" %}
{% load static %}
{% block content %}


{% if not game.date_started %}
  <h2>Game setup</h2>
{% else %}
  {% if not endgame_type %}
    <h2><span style="opacity: 0.3">Round {{round|add:'1'}}</span>  {{is_day|yesno:"Daytime discussions,Nightime creeping"}}</h2>
  {% else %}
    {% if game.next_game %}
      <h2>There's a new game with the same players</h2>
      <a class="btn btn-primary" href="{{next_invite_url}}">Join in</a>
    {% elif my_player.is_leader %}
      <a class="btn btn-primary" href="{% url 'matthews:new_game' %}?continue=1">Start a new game with same players</a>
    {% else %}
      <h2>Play more?</h2>
      <p>
        Kick <b>{{players.0.name}}</b> to start a new game. Once they've done that, hit refresh to get
        your joining link here.
      </p>

    {% endif %}
    <br>
    <br>

    <h2>Performance review</h2>
  {% endif %}

  <input id="update_opener" type="checkbox" class="d-none" {% if not my_action and not action_undone %}checked{% endif %}>
  <label class="update_panel" for="update_opener">
  {% if round == 0 and not endgame_type %}
    <h2>Introduction</h2>
    <p>The cracks were showing. The social fabric frayed. People did not know who to trust</p>
    <p>
      After weeks of tension, today trouble errupts. You hear a loud argument in the street - you
      investigate. There's a mob forming outside and with each joining person the clamouring rises.
    </p>
    <p>
      We want answers. Some want blood. All want to see a change.
    </p>
    <p>
      It starts today.
    </p>
    <p class="secret_note">
      text like this is a <b>secret note</b>.<br>
      if you hear anyone talking about "<b>pineapples</b>" you'll
      know they have misunderstood...
    </p>
    <br><br>
    <span class="btn btn-primary float-right">Choose the player you'd like to lynch, or vote for nobody to be killed</a>
  {% elif endgame_type %}
    <h2>
      {% if endgame_type == 'bad' %}
        The bad guys win
      {% elif endgame_type == 'truce' %}
        It's a draw
      {% elif endgame_type == 'good' %}
        The good guys win
      {% endif %}
    </h2>
    <p>
      <br>
    {% if endgame_type == 'bad' %}
      With <b>{{deaths.0}}</b>'s last breath they gasped "you'll never divide us" - little
      did they know it was already too late...
    {% elif endgame_type == 'truce' %}
      What had they become? <b>{{game.list_good_guys.0}}</b> and <b>{{game.list_bad_guys.0}}</b>'s eyes met across the road.
      All they had now was each other. {{game.list_bad_guys.0}} winked - {{game.list_good_guys.0}} smiled...
    {% elif endgame_type == 'good' %}
      With <b>{{deaths.0}}</b> gone for good the dark cloud lifted from the people. The rot had been stopped and
      the survivors lived in peace and harmony. For now...
    {% endif %}
    </p>

    <br><br>
    <span class="btn btn-primary float-right">Review the game summary</a>

  {% else %}
    {% if is_day %}  {####################################### WAKEY WAKEY IT'S MORNING #}
    <h2>Morning update</h2>
      {% for dead in deaths %}
      {% if my_player.id == dead.id %}
      <p class="dead-instructions">
        You died a painful death!
        <i>
          You may not communicate with other players until the end of the game.
          You're allowed to make ghostly noises but only at random times.
          Each night you will get the chance to haunt the dreams of those who wronged you
          and the community that couldn't keep you safe.
        </i>
      </p>
      {% endif %}
      <p>
        {{death_report|linebreaks}}
      </p>
      <p>
        <b>{{dead}}</b> is the latest victim of the mafia.
        {% include 'matthews/_death_suspicion_pc.html' with player=dead %}
      </p>
      {% empty %}
      <p>
        Despite reports of strange activities overnight no one was harmed. The group reconvenes to
        discuss the events of the night before.
      </p>
      {% endfor %}

      {% if suspect %}
      <p class="secret_note">
        info: <b>{{suspect}}</b> is {% if suspect.character_id == MAFIA_ID %}in the mafia{% else %}one of the good guys{% endif %}
      </p>
      {% elif haunting_action %}
      <p class="secret_note">
        you heard <b>{{haunting_action.done_by}}</b>'s  voice in the morning breeze - could it be..?
      </p>
      {% endif %}

      <br><br>
      <span class="btn btn-primary float-right">
        {% if my_player.died_in_round <= round %}
          Haunt the living souls that put you in the ground <i>(does nothing!)</i>
        {% else %}
          Choose the player you'd like to lynch, or vote for nobody to be killed
        {% endif %}
      </a>
    {% else %}                  {####################################### SLEEPY SLEEPY IT'S EVENING #}
    <h2>Evening update</h2>
      {% if my_player.id == deaths.0.id %}
      {# todo - de-dupe this with same for night time killing #}
      <p class="dead-instructions">
        You were found guilty and excuted to death!
        <i>
          You cannot speak to other players until the end of the game.
          You may make ghostly noises at purely random times.
          By day and night you will get the chance to haunt those who wronged you
          and the community that couldn't keep you safe.
        </i>
      </p>
      {% endif %}
      <p>
        {% regroup votes by done_to as votes_for %}
        {% for target, votes in votes_for %}
        {% for vote in votes %}
          {% if forloop.last and not forloop.first %}and{% endif %}
          {{vote.done_by}}{% if forloop.revcounter > 2 %},{% endif %}
        {% endfor %} voted for {{target|default_if_none:'no lynching'}}<br>
        {% endfor %}
      </p>
      {% for dead in deaths %}
      <p>
        The people have spoken and decided to put <b>{{dead}}</b> to death by hanging.
        {% include 'matthews/_death_suspicion_pc.html' with player=dead %}
      </p>
      {% empty %}
      <p>
        We thought better of our lynching instincts and everyone made it to bed safely.
      </p>
      {% endfor %}

      {% if haunting_action %}
      <p class="secret_note">
        you saw a picture of <b>{{haunting_action.done_by}}</b> and it brought a tear to your eye
      </p>
      {% endif %}

      <br><br>
      <span class="btn btn-primary float-right">Without conferring, choose who you {% include 'matthews/_action_name.html' with player=my_player %}</a>
    {% endif %}

  {% endif %}
  </label>

{% endif %}



<form class="vote-form {% if endgame_type %}game_over{% endif %}" action="{% url 'matthews:target' %}" method="POST">
  {% csrf_token %}
  {% for player in players %}
    <input type="radio" name="target" id="player_{{player.id}}" value="{{player.id}}" {%if my_action or endgame_type or not game.date_started%}disabled {%if my_action.done_to == player %}checked {%endif%}{%endif%}>
    <label class="avatar n{{forloop.counter0}} {% if my_player.character_id == MAFIA_ID and player.character_id == MAFIA_ID %}mark_bad{% endif%}
                  {{player.died_in_round|yesno:'mark_dead,mark_dead,'}}
                  "
           for="player_{{player.id}}">
      <h2>
        {{player.name}}
        {% if debug and my_player.id != player.id %}
        <a class="play_as" href="{% url 'matthews:game' %}?play_as_id={{player.id}}" title="{{player.character.name}}">@</a>
        {% endif %}
      </h2>
      <div class="portrait"></div>
      <p class="info">
      {% if my_player.id == player.id %}
      <span>You{% if my_player.character %}, {{my_player.character}}{%endif%}</span>
      {% elif my_player.character_id == MAFIA_ID and player.character_id == MAFIA_ID %}
      <span>{{player.character}}</span>
      {% else %}
      <span>&nbsp;</span>
      {% endif %}
      <br>
      {% if my_player.is_leader and not game.date_started %}
      <a href="{% url 'matthews:remove_player' player.id %}" class="btn btn-danger btn-sm">remove</a>
      {% elif my_player.id == player.id and my_action %}
      <i>chose {% if my_action.done_to %}{{my_action.done_to.name}}{% else %}Nobody {% endif %}</i>
      {% elif player.has_acted %}
        {% if not is_day and game.options.gameplay.mafia_kills_shared and my_player.character_id == MAFIA_ID and player.character_id == MAFIA_ID %}
        <i>targeted {% if player.action.done_to %}{{player.action.done_to.name}}{% else %}Nobody {% endif %}</i>
        {% elif is_day and game.options.gameplay.lynching_shared %}
        <i>chose {% if player.action.done_to %}{{player.action.done_to.name}}{% else %}Nobody {% endif %}</i>
        {% else %}
        <i>has acted</i>
        {% endif %}
      {% else %}
      <i>&nbsp;</i>
      {% endif %}
      </p>

      {% if not my_action %}
      <input type="submit" value="{% include 'matthews/_action_name.html' with player=my_player %}" class="btn btn-primary">
      {% else %}
      <input type="submit" name="cancel" value="undo choice" class="btn btn-secondary">
      {% endif %}
    </label>
    <div class="player_results">
    {% if endgame_type %}
      <h4>
        {{player.character}},
        {% if player.died_in_round %}
          {{player.died_in_round|divisibleby:'2'|yesno:"lynched, murdered"}} in round {{player.died_in_round}}
        {% else %}
          survived
        {% endif %}
      </h4>
      <p>
        Killed {{player.killed_bad|add:player.lynched_bad}} bad guy{{player.killed_bad|add:player.lynched_bad|pluralize}} and
          {{player.killed_good|add:player.lynched_good}} good guy{{player.killed_good|add:player.lynched_good|pluralize}}<br>
        {% if player.character_id == 1 %}
          Effective assisination: {{player.successful_kill_pc|floatformat:0}}%<br>
          {{player.killed_doctor|yesno:"Killed,Failed to kill"}} doctor
          {% if player.killed_doctor != player.killed_detective %}but{% else %}and{% endif %}
          {{player.killed_detective|yesno:"killed,failed to kill"}} detective<br>
        {% elif player.character_id == 2 %}
          Suspicions were accurate {{player.suspected_bad_pc|floatformat:0}}% of the time<br>
        {% elif player.character_id == 3 %}
          Saved {{player.lives_saved}} {{player.lives_saved|pluralize:'life,lives'}}<br>
        {% elif player.character_id == 4 %}
          Mafia discovered: {{player.mafia_found}}<br>
        {% endif %}
        {% if player.character_id != MAFIA_ID %}
          {% if player.mafia_target %}
          Was attacked {{player.mafia_target}} time{{player.mafia_target|pluralize}}
          {% else %}
          Was never targeted by the mafia
          {% endif %}
        {% endif %}
        {% if player.character_id == MAFIA_ID and player.mafia_target %}
          Was attacked by fellow mafia members {{player.mafia_target}} time{{player.mafia_target|pluralize}}
        {% endif %}
      </p>
    {% endif %}
    </div>
  {% endfor %}

  {% if game.date_started %}
    <input type="radio" name="target" id="player_0" value="0" {%if my_action or endgame_type or not game.date_started %}disabled {%if my_action and my_action.done_to is None %}checked {%endif%}{%endif%}>
    <label class="avatar" for="player_0">
      {% if not my_action %}
      {% endif %}
      <h2>Nobody</h2>
      <div class="portrait"></div>
      {% if not my_action %}
      <input type="submit" value="{% include 'matthews/_action_name.html' with player=my_player %}" class="btn btn-primary">
      {% else %}
      <input type="submit" name="cancel" value="undo choice" class="btn btn-secondary">
      {% endif %}
    </label>
    {% if endgame_type %}
      <div class="player_results">
        <h4>The choice to do nothing, survived!</h4>
        <p>
          Killed: no bad guys, no good guys - super nice dude<br>
          Lynched 22 times and did nothing wrong<br>
          Saved by the doctor, who is an idiot<br>
        </p>
      </div>
    {% endif %}
  {% endif %}
<br>
{% if my_action %}
  {% include 'matthews/_waiting_ajax.html' %}
{% endif %}
<input type="hidden" name="round" value="{{round}}">
</form>


{% if not game.date_started %}
  <h2>Options</h2>
  {% if not my_player.is_leader %}
    <p class="my-2">{{players.0.name}} is in control of these options, ask them to make changes if you like.</p>
  {% endif %}
  <form class="options-form" action="{% url 'matthews:update_options'%}" method="POST">
  {% csrf_token %}

  <table class="w-100">
    <tr>
      <th>Character</th>
      <th>Frequency</th>
      <th>Minimum</th>
      <th>Odds with <span class="num-players">current players</span></th>
    </tr>
  {% for character_id, opts in role_options.items %}
    <tr>
      <td>{{opts.name}}</td>
      <td>
        <input type="hidden" name="character_ids[]" value="{{character_id}}" {{my_player.is_leader|yesno:",disabled"}} >
        <input type="range" name="pc_{{character_id}}" min="0" max="50" value="{{opts.pc}}" class="custom-range w-100 align-middle" {{my_player.is_leader|yesno:",disabled"}}>
      </td>
      <td>
        <input class="form-control text-right" name="min_{{character_id}}" value="{{opts.min}}" style="width: 60px;" {{my_player.is_leader|yesno:",disabled"}}>
      </td>
      <td class="character-likelihood">
      </td>
    </tr>
  {% endfor %}
  </table>


  <div class="options-list {{my_player.is_leader|yesno:"edit,"}}">
    {% for option, details in gameplay_options.items %}
    <input class="chex" type="checkbox" name="game_options[]" id="{{option}}"
      {%if option in game.options.gameplay %}checked{%endif%} value="{{option}}" {{my_player.is_leader|yesno:",disabled"}}>
    <label class="form-check-label" for="{{option}}">
      {{details.description|safe}}
    </label>
    <br>
    {% endfor %}
  </div>

  {% if my_player.is_leader %}
    <div class="mt-2 w-100 text-right">
      <input class="btn btn-light" type="submit" name="reset" value="Reset to default">
      <input class="btn btn-primary" type="submit" value="Save options">
      <input class="btn btn-primary" type="submit" name="start" value="Start game">
    </div>
  {% endif %}
  </form>

  <br>

  <style>
  .options-form sub {color: #ccc}

  .options-list [type=checkbox] {
    margin: 0.5em 0;
  }
  .options-list [type=checkbox] + label {
    margin: 0.5em 0 0.5em 0.3em;
    display: inline-block;
    opacity: 0.6;
    cursor: pointer;
  }

  .options-list:not(.edit) [type=checkbox] {
    display: none;
  }
  .options-list:not(.edit) [type=checkbox] + label {
    display: none;
  }

  .options-list [type=checkbox]:checked {
    display: inline-block;
  }
  .options-list [type=checkbox]:checked + label {
    text-decoration: none;
    display: inline-block;
    opacity: 1;
  }
  .options-list:not(.edit) * {
    pointer-events: none;
    filter: grayscale(1);
  }

  /* checkbox replacement */
  /*   .chex is a styled up version of a normal checkbox */
  input[type=checkbox].chex {
    position: relative;
    top: 0.2em;
    height: 1.2em;
    margin-right: 1.2em;
    width: 0;
    vertical-align: top;
    cursor: pointer;
  }
  input[type=checkbox].chex:disabled {
    cursor: default;
    filter: grayscale(1);
  }
  input[type=checkbox].chex:disabled + label {
   cursor: default;
  }
  input[type=checkbox].chex:before,
  input[type=checkbox].chex:after {
    content: '';
    display: block;
    position: absolute;
    top: 0;
    bottom:0;
    left: 0;
    width: 1.2em;
  }
  input[type=checkbox].chex:before{
    box-shadow: 0 0 4px rgba(0,0,0,0.3) inset;
    border-radius: 20%;
    background-color: #fff;
  }
  input[type=checkbox].chex:hover:before {
    box-shadow: 0 0 4px rgba(0,0,0,0.3) inset;
  }
  input[type=checkbox].chex:checked:after {
    content: '✓';
    font-size: 1.6em;
    top: -0.5em;
    left: 0.1em;
    font-weight: bold;
    color: var(--primary);
    text-shadow: 1px 2px 2px rgba(0,0,0,0.3);
  }


  {% if my_player.is_leader %}
    .options-form td:nth-child(2) { width: 50%;}
    .options-form td:nth-child(4) { width: 25%;}
  {% else %}
    .options-form th:nth-child(2),
    .options-form th:nth-child(3),
    .options-form td:nth-child(2),
    .options-form td:nth-child(3) { display: none;}
  {% endif %}
  </style>
  <script>

    $(function(){
      $('.options-form').on('input', 'input', function(){
        num_players = $('.avatar').length;
        $('.num-players').html(num_players + (num_players==1?" player":" players"));
        $('.character-likelihood').each(function(){
          pc_char  = parseInt($(this).parent('tr').find('[name^=pc_]').val());
          min_char = parseInt($(this).parent('tr').find('[name^=min_]').val());
          $(this).html(describe_character_odds(num_players, pc_char, min_char));
        })
      });

      $('.options-form input').trigger('input')
    })
  </script>

  <h2>Rules</h2>
  {% include 'matthews/_rules.html' %}

  <br>

  {% if my_player.is_leader  %}
    <h2>Invite more players</h2>
    <form action="{% url 'matthews:invite' game.id %}" method="POST">
    {% csrf_token %}
      <textarea name="name_and_email" class="w-100 h-5" rows=4 placeholder="add like: Steve, stevie@gmail.com  (separated by new line)"></textarea>
      <p>(we don't store the email address, we send a single invite email)</p>
      <input type="submit" value="Invite to game" class="btn btn-primary">
    </form>
  {% else %}
    <h2>Waiting for all invited players to join</h2>
    {{players.0.name}} is in charge of starting game, bug them if you think we should just crack on with it
    {% include 'matthews/_waiting_ajax.html' %}
  {% endif %}

{% else %}{# if game started #}
  <div class="btn-group mt-5">
  {% if my_player.is_leader  %}
    <a class="btn btn-light btn-sm " href="{% url 'matthews:restart_round' round %}"
       onclick="return confirm('Are you sure? This will undo all actions since start of round {{round|add:1}}');"
       >Restart this round</a>
    {% if round > 0 %}
      <a class="btn btn-light btn-sm" href="{% url 'matthews:restart_round' round|add:-1 %}"
         onclick="return confirm('Are you sure? This will undo all actions since start of round {{round}}');"
         >Restart previous round</a>
    {% endif %}
    <a class="btn btn-light btn-sm" href="{% url 'matthews:restart'%}"
       onclick="return confirm('Are you sure? This will return all players to the setup stage and delete their characters and moves from this game.');"
       >Restart whole game</a>
  {% endif %}

  {% if debug %}
    <a class="btn btn-light btn-sm mx-2" href="{% url 'matthews:cast-all' %}">Cast all remaining votes</a>
  {% endif %}
  </div>

    <br>
    <input type="checkbox" class="open_next" id="open_next_rules">
    <label for="open_next_rules" class="btn btn-light w-100">Review character mix, rules and modifiers</label>
    <label class="row bg-light" for="open_next_rules">
      <div class="col-0 col-md-1"></div>
      <div class="col-12 col-md-10 p-3">
        <h4>Character mix</h4>
        <p>
          There will be
          {% for character_id, opts in role_options.items %}
            {% if forloop.last and not forloop.first %}and{% endif %}
            <span class="describe_odds" data-num="{{players|length}}" data-pc="{{opts.pc}}" data-min="{{opts.min}}" data-name="{{opts.name}}"></span>
            {% if forloop.revcounter > 2 %},{% endif %}
          {% endfor %}
        </p>

        <h4>Game options in play</h4>
        <ul>
          {% for option, details in gameplay_options.items %}
            {% if option in game.options.gameplay %}
            <li>{{details.description|safe}}</li>
            {% endif %}
          {% endfor %}
          {% if not game.options.gameplay|length %}
            <li>No modifiers are in play</li>
          {% endif %}
        </ul>

        <h4>Base rules</h4>
        {% include 'matthews/_rules.html' %}

      </div>
    </label>
  {% if not endgame_type %}
  {% endif %}

{% endif %}

{% if my_player.is_leader or endgame_type %}
<div class="secret-link input-group mt-5">
  <div class="input-group-prepend">
    <div class="input-group-text">Your secret link to this game</div>
  </div>
  <input class="link_box form-control" value="{{invite_url}}" onclick="this.select()">
</div>
{% endif %}

<script>
$(function(){
  $('.describe_odds').each(function(){
    $(this).html(describe_character_odds($(this).attr('data-num'), $(this).attr('data-pc'),
                                         $(this).attr('data-min'), $(this).attr('data-name')));
  })
})

// return a string describing the likelihood based on the number of players, the percentage
// of players who should have that role and a minimum
function describe_character_odds(num_players, percentage, minimum, name=''){
  if(percentage == 0){
    min = minimum;
    max = minimum;
  }else{
    num_char = num_players * percentage / 100;
    min      = Math.max(minimum, Math.floor(num_char));
    max      = Math.max(minimum, Math.ceil(num_char));
    pc_max   = parseInt((num_char % 1) * 100);
    pc_min   = 100 - pc_max;
  }
  if(name && (max != 1 || min != 1)){
      name += 's'
  }
  if(max==min){
    return `${min} <sub>100%</sub> ${name}`;
  }else{
    return `${min} <sub>${pc_min}%</sub> or ${max} <sub>${pc_max}%</sub> ${name}`;
  }
}
</script>


<style>
.describe_odds sub {color: #ccc}

.open_next {display: none;}
.open_next + label {}
.open_next + label:after {font-size: 80%; content: '\00a0\00a0\00a0▼'; opacity: 0.5}
.open_next:checked + label:after {content: '\00a0\00a0\00a0▲';}
.open_next + label + * {max-height: 0; overflow: hidden; transition: 0.2s;}
.open_next:checked + label + * {max-height: 50em; transition: 0.2s;}

.update_panel {
  z-index: 3;
  position: absolute;
  width: 19em;
  height: 2.5em;
  border-radius: 0.2em;
  top: -1em;
  right: 0.1em;
  overflow: hidden;
  background-color: #fec;
  box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
  transform: rotate(3deg);
  transition: 0.1s;
  padding-left: 2em;
  cursor: pointer;
}
[type=checkbox]:checked + .update_panel{
  display: block;
  top: 1em;
  right: 1em;
  width: 85%;
  padding: 2em;
  margin: 5%;
  height: auto;
  min-height: 20em;
  transform: rotate(-1deg);
}
.update_panel > h2 { margin-bottom: 0.2em;}
.secret_note {
  color: #224c98;
  font-size: 200%;
  text-align: center;
  transform: rotate(5deg);
  font-family: 'Homemade Apple', cursive;
}
.dead-instructions {
  background-color: #fce;
  padding: 2em;
}


.mark_dead { filter: grayscale(1); opacity: 0.5;}
.win_text{
  font-size: 6em;
  color: red;
}
.play_as {
  position: absolute;
  right: 0;
  bottom: 1em;
  display: none;
}
.avatar:hover .play_as { display: block; }

.vote-form {text-align:center;}

[type=radio] {display:none;}
.avatar {
  display:inline-block;
  height: 172px;
  margin: 1em 1em 4em;
  position: relative;
  cursor: pointer;
  vertical-align: top;
  transition: 0.1s;
  background-color: #f2e9e4;
}
.avatar > h2{
  overflow: hidden;
  padding: 0.1em;
  margin-bottom: 0em;
}

[type=radio]:disabled + .avatar { cursor: default; }
[type=radio]:checked + .avatar
{
  transform: scale(1.1);
  box-shadow: 2px 3px 4px rgba(0,0,0,0.2);
  background-color: #007bff;
  cursor: default;
}
[type=radio]:checked + .avatar h2 { color: white; }

.portrait {
  width: 115px;
  height: 123px;
  background: url('{% static 'matthews/images/avatar_test.jpg' %}') top left no-repeat #f2e9e4;
  background-size: 350px 360px;
  margin: 0em auto 0.5em;

}
.avatar.n0 .portrait { background-position: top left; }
.avatar.n1 .portrait { background-position: top center; }
.avatar.n2 .portrait { background-position: top right; }
.avatar.n3 .portrait { background-position: center left; }
.avatar.n4 .portrait { background-position: center center; }
.avatar.n5 .portrait { background-position: center right; }
.avatar.n6 .portrait { background-position: bottom left; }
.avatar.n7 .portrait { background-position: bottom center; }
.avatar.n8 .portrait { background-position: bottom right; }
[for=player_0] .portrait { background-image: none; background-color: #f2e9e4;}

.vote-form [type=submit] {
  position: absolute;
  top: 80%;
  width: 120%;
  left: -10%;
  display: none;
  z-index: 2;
  cursor: pointer;
}
.vote-form [type=radio]:checked + .avatar [type=submit] {display: block;}

.player_results {
  width: 65%;
  margin: 1em;
  text-align: left;
  padding: 1em;
  display: none;
}

.game_over .player_results {
  display: inline-block;
}

.waiting {
  position: fixed;
  text-align: center;
  bottom: 0;
  left:0;
  right:0;
  padding: 0.5em;
  background-color: #cef;
  z-index: 5;
}
.waiting > * { vertical-align: baseline; }
.secret-link {position: absolute; top: 100%; left: 0;}



/* from https://projects.lukehaas.me/css-loaders/ */
.loader,
.loader:before,
.loader:after {
  border-radius: 50%;
}
.loader {
  vertical-align: middle;
  display: inline-block;
  color: #cef;
  position: relative;
  width: 1em;
  height: 1em;
  border: 0.25em solid #007bff;
  transform: translateZ(0) scale(1);
}
.loader:before,
.loader:after {
  position: absolute;
  content: '';
  width: 0.6em;
  height: 1.2em;
  background: #cef;
  top: -0.35em;
}
.loader:before {
  left: -.35em;
  border-radius: 0.6em 0 0 0.6em;
  animation: load2 2s infinite ease 1.5s;
  transform-origin: 0.6em 0.6em;
}
.loader:after {
  left: 0.25em;
  border-radius: 0 1em 1em 0;
  animation: load2 2s infinite ease;
  transform-origin: 0em 0.6em;
}
@keyframes load2 {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
</style>

{% endblock %}


